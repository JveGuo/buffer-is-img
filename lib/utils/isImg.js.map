{
  "version": 3,
  "sources": ["../../src/utils/isImg.ts"],
  "sourcesContent": ["/**\n * @Author: jiawei.guo\n * @Date: 2022-11-25 22:19:21\n * @Description: \u5224\u65AD\u6587\u4EF6\u662F\u5426\u662F\u56FE\u7247\u683C\u5F0F\n */\nimport { red } from \"chalk\";\n\n// \u901A\u8FC7\u5C06\u56FE\u7247\u8D44\u6E90\u7684\u4E8C\u8FDB\u5236\u6D41\u4E0E\u8BE5\u6807\u8BC6\u505A\u6BD4\u5BF9\uFF0C\u5373\u53EF\u5224\u65AD\u56FE\u7247\u683C\u5F0F\nexport const bufferIsImg = (fileBuffer: Buffer) => {\n  try {\n    if (\n      !fileBuffer ||\n      typeof fileBuffer !== \"object\" ||\n      !Buffer.isBuffer(fileBuffer)\n    ) {\n      throw new Error(\"\u53C2\u6570\u4E0D\u662F 'buffer' \u7C7B\u578B\");\n    }\n\n    // \u6587\u4EF6\u6807\u8BC6\u5934 \u5B57\u8282\u6570\u7EC4\n    const imageBufferHeaders = [\n      { bufBegin: [0xff, 0xd8], bufEnd: [0xff, 0xd9], suffix: \".jpg\" },\n      { bufBegin: [0x00, 0x00, 0x02, 0x00, 0x00], suffix: \".tga\" },\n      { bufBegin: [0x00, 0x00, 0x10, 0x00, 0x00], suffix: \".rle\" },\n      {\n        bufBegin: [0x89, 0x50, 0x4e, 0x47, 0x0d, 0x0a, 0x1a, 0x0a],\n        suffix: \".png\",\n      },\n      { bufBegin: [0x47, 0x49, 0x46, 0x38, 0x39, 0x61], suffix: \".gif\" },\n      { bufBegin: [0x47, 0x49, 0x46, 0x38, 0x37, 0x61], suffix: \".gif\" },\n      { bufBegin: [0x42, 0x4d], suffix: \".bmp\" },\n      { bufBegin: [0x0a], suffix: \".pcx\" },\n      { bufBegin: [0x49, 0x49], suffix: \".tif\" },\n      { bufBegin: [0x4d, 0x4d], suffix: \".tif\" },\n      {\n        bufBegin: [0x00, 0x00, 0x01, 0x00, 0x01, 0x00, 0x20, 0x20],\n        suffix: \".ico\",\n      },\n      {\n        bufBegin: [0x00, 0x00, 0x02, 0x00, 0x01, 0x00, 0x20, 0x20],\n        suffix: \".cur\",\n      },\n      { bufBegin: [0x46, 0x4f, 0x52, 0x4d], suffix: \".iff\" },\n      { bufBegin: [0x52, 0x49, 0x46, 0x46], suffix: \".ani\" },\n    ];\n\n    for (const imageBufferHeader of imageBufferHeaders) {\n      let isEqual;\n\n      // \u5224\u65AD\u6807\u8BC6\u5934\u524D\u7F00\n      if (imageBufferHeader.bufBegin) {\n        const buf = Buffer.from(imageBufferHeader.bufBegin);\n        isEqual = buf.equals(\n          //\u4F7F\u7528 buffer.slice \u65B9\u6CD5 \u5BF9 buffer \u4EE5\u5B57\u8282\u4E3A\u5355\u4F4D\u5207\u5272\n          fileBuffer.slice(0, imageBufferHeader.bufBegin.length)\n        );\n      }\n\n      // \u5224\u65AD\u6807\u8BC6\u5934\u540E\u7F00\n      if (isEqual && imageBufferHeader.bufEnd) {\n        const buf = Buffer.from(imageBufferHeader.bufEnd);\n        isEqual = buf.equals(\n          fileBuffer.slice(-imageBufferHeader.bufEnd.length)\n        );\n      }\n\n      if (isEqual) {\n        return imageBufferHeader.suffix;\n      }\n    }\n\n    // \u672A\u80FD\u8BC6\u522B\u5230\u8BE5\u6587\u4EF6\u7C7B\u578B\n    return \"\";\n  } catch (error) {\n    console.log(red(`\u2718 ${(error as Error).message}`));\n  }\n};\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA,mBAAoB;AAGb,IAAM,cAAc,CAAC,eAAuB;AACjD,MAAI;AACF,QACE,CAAC,cACD,OAAO,eAAe,YACtB,CAAC,OAAO,SAAS,UAAU,GAC3B;AACA,YAAM,IAAI,MAAM,gDAAkB;AAAA,IACpC;AAGA,UAAM,qBAAqB;AAAA,MACzB,EAAE,UAAU,CAAC,KAAM,GAAI,GAAG,QAAQ,CAAC,KAAM,GAAI,GAAG,QAAQ,OAAO;AAAA,MAC/D,EAAE,UAAU,CAAC,GAAM,GAAM,GAAM,GAAM,CAAI,GAAG,QAAQ,OAAO;AAAA,MAC3D,EAAE,UAAU,CAAC,GAAM,GAAM,IAAM,GAAM,CAAI,GAAG,QAAQ,OAAO;AAAA,MAC3D;AAAA,QACE,UAAU,CAAC,KAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,EAAI;AAAA,QACzD,QAAQ;AAAA,MACV;AAAA,MACA,EAAE,UAAU,CAAC,IAAM,IAAM,IAAM,IAAM,IAAM,EAAI,GAAG,QAAQ,OAAO;AAAA,MACjE,EAAE,UAAU,CAAC,IAAM,IAAM,IAAM,IAAM,IAAM,EAAI,GAAG,QAAQ,OAAO;AAAA,MACjE,EAAE,UAAU,CAAC,IAAM,EAAI,GAAG,QAAQ,OAAO;AAAA,MACzC,EAAE,UAAU,CAAC,EAAI,GAAG,QAAQ,OAAO;AAAA,MACnC,EAAE,UAAU,CAAC,IAAM,EAAI,GAAG,QAAQ,OAAO;AAAA,MACzC,EAAE,UAAU,CAAC,IAAM,EAAI,GAAG,QAAQ,OAAO;AAAA,MACzC;AAAA,QACE,UAAU,CAAC,GAAM,GAAM,GAAM,GAAM,GAAM,GAAM,IAAM,EAAI;AAAA,QACzD,QAAQ;AAAA,MACV;AAAA,MACA;AAAA,QACE,UAAU,CAAC,GAAM,GAAM,GAAM,GAAM,GAAM,GAAM,IAAM,EAAI;AAAA,QACzD,QAAQ;AAAA,MACV;AAAA,MACA,EAAE,UAAU,CAAC,IAAM,IAAM,IAAM,EAAI,GAAG,QAAQ,OAAO;AAAA,MACrD,EAAE,UAAU,CAAC,IAAM,IAAM,IAAM,EAAI,GAAG,QAAQ,OAAO;AAAA,IACvD;AAEA,eAAW,qBAAqB,oBAAoB;AAClD,UAAI;AAGJ,UAAI,kBAAkB,UAAU;AAC9B,cAAM,MAAM,OAAO,KAAK,kBAAkB,QAAQ;AAClD,kBAAU,IAAI;AAAA,UAEZ,WAAW,MAAM,GAAG,kBAAkB,SAAS,MAAM;AAAA,QACvD;AAAA,MACF;AAGA,UAAI,WAAW,kBAAkB,QAAQ;AACvC,cAAM,MAAM,OAAO,KAAK,kBAAkB,MAAM;AAChD,kBAAU,IAAI;AAAA,UACZ,WAAW,MAAM,CAAC,kBAAkB,OAAO,MAAM;AAAA,QACnD;AAAA,MACF;AAEA,UAAI,SAAS;AACX,eAAO,kBAAkB;AAAA,MAC3B;AAAA,IACF;AAGA,WAAO;AAAA,EACT,SAAS,OAAP;AACA,YAAQ,QAAI,kBAAI,UAAM,MAAgB,SAAS,CAAC;AAAA,EAClD;AACF;",
  "names": []
}
